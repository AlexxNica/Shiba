<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="../bower_components/paper-header-panel/paper-header-panel.html">
<link rel="import" href="../bower_components/paper-toolbar/paper-toolbar.html">
<link rel="import" href="lint-message.html">

<dom-module id="lint-panel">

  <style is="custom-style">
    :host {
      font-family: "Helvetica Neue", Helvetica, "Segoe UI", Arial, freesans, sans-serif;
    }
    .paper-header {
      color: white;
      @apply(--shadow-elevation-2dp);
      margin-bottom: 12px;
      font-size: 1.5em;
      padding: 4px;
    }
    :host > ::content [green_bg] {
      background-color: var(--paper-green-500);
    }
    :host > ::content [red_bg] {
      background-color: var(--paper-red-500);
    }
    #content-wrapper {
      margin: 12px;
      background-color: lightgray;
    }
    #rule-link {
      float: right;
      margin: 12px;
    }
    .link {
      cursor: pointer;
      color: gray;
    }
    #lint-content {
      font: inherit;
    }
  </style>

  <template id="body">
    <paper-header-panel class="flex" mode="scroll">
      <div class="paper-header" id="lint-header" green_bg>No error</div>
      <div id="content-wrapper">
        <code id="lint-content"></code>
      </div>
      <footer id="rule-link"><span class="link" on-click="_showLintRules">lint rules</span></footer>
    </paper-header-panel>
  </template>

  <script>
    'use strict';
    let open = null;

    Polymer({
      is: 'lint-panel',

      properties: {
        content: {
          type: Array,
          observer: '_contentUpdated'
        },
        lint_url: String
      },

      _setMessages(messages) {
        let content = document.getElementById('lint-content');

        for (const m of messages) {
          let msg = document.createElement('lint-message');
          msg.message = m;
          content.appendChild(msg);
        }
      },

      _contentUpdated: function(messages) {
        this._setMessages(messages);

        let header = document.getElementById('lint-header');
        if (messages.length > 0) {
          header.innerText = 'Error';
          header.setAttribute('red_bg', '');
        } else {
          header.innerText = 'No error';
          header.setAttribute('green_bg', '');
        }
      },

      _showLintRules: function() {
        if (this.lint_url === undefined) {
          console.log('No lint URL');
          return;
        }

        if (!open) {
          open = require('open');
        }

        open(this.lint_url);
      }
    });
  </script>
</dom-module>
